var v=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var U=(o,t)=>{for(var r in t)v(o,r,{get:t[r],enumerable:!0})},_=(o,t,r,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of y(t))!q.call(o,s)&&s!==r&&v(o,s,{get:()=>t[s],enumerable:!(e=Z(t,s))||e.enumerable});return o};var j=o=>_(v({},"__esModule",{value:!0}),o);var sr={};U(sr,{default:()=>I});module.exports=j(sr);var u=require("obsidian");var F={"lei complementar":"LC","lei ordin\xE1ria":"LO",lei:"L","decreto-lei":"DL",decreto:"D","medida provis\xF3ria":"MP","emenda constitucional":"EC",resolu\u00E7\u00E3o:"Res",portaria:"Port","instru\xE7\xE3o normativa":"IN"};function k(o){let t=/\*\*\[?(LEI COMPLEMENTAR|LEI ORDINÁRIA|LEI|DECRETO-LEI|DECRETO|MEDIDA PROVISÓRIA|EMENDA CONSTITUCIONAL|RESOLUÇÃO|PORTARIA|INSTRUÇÃO NORMATIVA)\s*[Nn]?[ºª°]?\s*(\d+(?:\.\d+)?),?\s*DE\s*\d+\s*DE\s*\w+\s*DE\s*(\d{4})/i,r=o.match(t);if(!r)return null;let e=B(r[1]),s=r[1].toLowerCase(),i=F[s]||e.substring(0,2).toUpperCase(),n=r[2],a=r[3];return{tipoCompleto:e,tipoAbreviado:i,numero:n,ano:a}}function B(o){return o.toLowerCase().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function z(o){let{tipoCompleto:t,tipoAbreviado:r,numero:e,ano:s}=o;return[`${t} n\xBA ${e}/${s}`,`${r} n\xBA ${e}/${s}`,`${t} ${e}/${s}`,`${r} ${e}/${s}`]}function E(o){let t=/^---\n([\s\S]*?)\n---/,r=o.match(t);if(!r)return o;let e=r[1],s=k(o);if(!s)return o;let n=`aliases:
${z(s).map(a=>`  - "${a}"`).join(`
`)}`;if(/^aliases:/m.test(e)){let a=e.replace(/^aliases:[\s\S]*?(?=\n\w|\n$)/m,n);return o.replace(t,`---
${a}
---`)}else{let a=`${e}
${n}`;return o.replace(t,`---
${a}
---`)}}function T(o){let t=/\|\s*!\[.*?[Bb]ras.*?\]\(.*?\)\s*\|.*\|\n\|\s*---\s*\|\s*---\s*\|\n?/g;return o.replace(t,"")}function G(o=6){let t="abcdefghijklmnopqrstuvwxyz0123456789",r="";for(let e=0;e<o;e++)r+=t.charAt(Math.floor(Math.random()*t.length));return r}function d(o,t=6){let r;do r=G(t);while(o.has(r));return o.add(r),r}function A(o,t){let r={},e=o;return e=e.replace(/<table[\s\S]*?<\/table>/gi,s=>{let n=`<!--PROTECTED_TABLE_${d(t)}-->`;return r[n]=s,n}),e=e.replace(/(?:^\|.+\|$\n?)+/gm,s=>{if(s.includes("<!--PROTECTED_TABLE_")||s.trim().length<5)return s;let n=`<!--PROTECTED_TABLE_${d(t)}-->`;return r[n]=s,n}),{conteudo:e,tabelas:r}}function b(o,t){let r=o;for(let[e,s]of Object.entries(t))r=r.replace(e,s);return r}var H=[{pattern:/^(LIVRO\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:1},{pattern:/^(ANEXO\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:1},{pattern:/^(TÍTULO\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:2},{pattern:/^(CAPÍTULO\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:3},{pattern:/^(Seção\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:4},{pattern:/^(Subseção\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:5}];function C(o){let t=o.split(`
`),r=[],e=0;for(;e<t.length;){let s=t[e],i=s.trim();if(s.trimStart().startsWith(">")){r.push(s),e++;continue}let n=!1;for(let a of H){let l=i.match(a.pattern);if(l){let m=l[1],c="#".repeat(a.nivel),p="",f=e+1;for(;f<t.length;){let $=t[f].trim();if($===""||W($)){f++;continue}p=$,e=f;break}p?r.push(`${c} ${m} - ${p}`):r.push(`${c} ${m}`),n=!0;break}}n||r.push(t[e]),e++}return r.join(`
`)}function W(o){return[/^(LIVRO|ANEXO|TÍTULO|CAPÍTULO)\s+[IVXLCDM\d]+(?:-[A-Z])?$/i,/^(Seção|Subseção)\s+[IVXLCDM\d]+(?:-[A-Z])?$/i,/^Art\.\s*\d+/i,/^§\s*\d+/i,/^Parágrafo único/i,/^[IVXLCDM]+\s*[-–—]/,/^[a-z]\)\s*/,/^<!--/,/^\[.+\]$/].some(r=>r.test(o))}var O=/\s*\^([a-z0-9]{6})$/;function Y(o,t){let r=o.split(`
`);for(let e of r){let s=e.match(O);s&&t.add(s[1])}}function h(o,t){return O.test(o)?o:`${o} ^${d(t)}`}function S(o,t){Y(o,t);let r=o;return r=r.replace(/^(?!~~)(Art\.\s*\d+[º°]?.*)$/gm,e=>h(e,t)),r=r.replace(/^(?!~~)((?:§\s*\d+[º°]?|Parágrafo único).*)$/gm,e=>h(e,t)),r=r.replace(/^(?!~~)([IVXLCDM]+\s*[-–—].*)$/gm,e=>h(e,t)),r=r.replace(/^(?!~~)([a-z]\)\s*.*)$/gm,e=>h(e,t)),r}var J=[/^Art\.\s/i,/^§\s*\d+/i,/^Parágrafo único/i,/^[IVXLCDM]+\s*[-–—]/,/^[a-z]\)\s/];function V(o){let t=o.trimStart();return J.some(r=>r.test(t))}function P(o){var e;let t=o.split(`
`),r=[];for(let s of t){if(s.trim()===""){r.push(s);continue}if(s.trimStart().startsWith(">")){r.push(s);continue}if(s.trimStart().startsWith("~~")){r.push(s);continue}if((((e=s.match(/^(\s*)/))==null?void 0:e[1])||"").length>=4&&!V(s)){r.push(s);continue}V(s)?r.push(s.trimStart()):r.push(s)}return r.join(`
`)}var g=[/^\*\*(LIVRO\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i,/^\*\*(ANEXO\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i,/^\*\*(TÍTULO\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i,/^\*\*(CAPÍTULO\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i,/^\*\*(Seção\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i,/^\*\*(Subseção\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i];function K(o){let t=o.trim();return g.some(r=>r.test(t))}function Q(o){let t=o.trim(),r=t.replace(/^\*\*(.+)\*\*$/,"$1");return!r||[/^Art\.\s/i,/^§\s*\d+/i,/^Parágrafo único/i,/^[IVXLCDM]+\s*[-–—]/,/^[a-z]\)\s/,/^(LIVRO|ANEXO|TÍTULO|CAPÍTULO|Seção|Subseção)\s+[IVXLCDM\d]+(?:-[A-Z])?$/i].some(s=>s.test(r))?!1:/^\*\*[A-ZÀÁÂÃÇÉÊÍÓÔÕÚ]/.test(t)}function M(o){return o.replace(/^\*\*(.+)\*\*$/,"$1")}function N(o){let t=o.split(`
`),r=[];for(let e=0;e<t.length;e++){let s=t[e],i=s.trim();if(K(s)){r.push(M(i));continue}if(Q(s)){let n=!1;if(e>0){let a=t[e-1].trim();if((g.some(l=>l.test(`**${a}**`))||g.some(l=>l.test(a)))&&(n=!0),e>1&&a===""){let l=t[e-2].trim();(g.some(m=>m.test(`**${l}**`))||g.some(m=>m.test(l)))&&(n=!0)}}if(n){r.push(M(i));continue}}r.push(s)}return r.join(`
`)}var R=/\^([a-z0-9]{6})/g;function rr(o){let t=Array.from(o.matchAll(R));if(t.length<=1)return o;let r=t[0][1],e=o.replace(R,"").trim();return e=`${e} ^${r}`,e}function w(o){let t=o.split(`
`),r=0;return{conteudo:t.map(s=>{if(s.trimStart().startsWith("~~"))return s;let i=rr(s);return i!==s&&r++,i}).join(`
`),linhasCorrigidas:r}}var D=class{constructor(){this.tabelasProtegidas={};this.idsUtilizados=new Set}processar(t){let r=t;return r=this.removerBrasaoDoc(r),r=this.protegerTabelasDoc(r),r=this.processarFrontmatterDoc(r),r=this.converterNegritoDoc(r),r=this.removerIndentacaoDoc(r),r=this.converterHierarquiaDoc(r),r=this.adicionarIdsDoc(r),r=this.restaurarTabelasDoc(r),r=this.limparDuplicatasSimplesDoc(r),r}protegerTabelasDoc(t){let r=A(t,this.idsUtilizados);return this.tabelasProtegidas=r.tabelas,r.conteudo}restaurarTabelasDoc(t){return b(t,this.tabelasProtegidas)}processarFrontmatterDoc(t){return E(t)}removerBrasaoDoc(t){return T(t)}converterNegritoDoc(t){return N(t)}removerIndentacaoDoc(t){return P(t)}converterHierarquiaDoc(t){return C(t)}adicionarIdsDoc(t){return S(t,this.idsUtilizados)}limparDuplicatasSimplesDoc(t){return w(t).conteudo}};var L=/\^([a-z0-9]{6})/g;function tr(o){let t=o.split(`
`),r=[];return t.forEach((e,s)=>{let i=Array.from(e.matchAll(L));i.length>1&&r.push({linha:e,numeroLinha:s+1,ids:i.map(n=>n[1])})}),r}async function x(o,t,r){let e=o.getMarkdownFiles(),s=0,i=new RegExp(`\\[\\[(?:[^\\]]+)?#\\^${r}\\]\\]`,"g");for(let n of e)if(n.basename!==t.replace(".md",""))try{let l=(await o.cachedRead(n)).matchAll(i);s+=Array.from(l).length}catch(a){console.error(`Erro ao ler arquivo ${n.path}:`,a)}return s}async function er(o,t,r){let e=new Map;for(let n of r){let a=await x(o,t,n);e.set(n,a)}let s=r[0],i=e.get(r[0])||0;for(let n of r){let a=e.get(n)||0;a>i&&(i=a,s=n)}return s}function or(o,t){if(Array.from(o.matchAll(L)).length<=1)return o;let e=o.replace(L,"").trim();return e=`${e} ^${t}`,e}async function X(o,t,r){let e=tr(r);if(e.length===0)return{conteudo:r,relatorio:["Nenhum ID duplicado encontrado."]};let s=r.split(`
`),i=[];i.push(`Encontradas ${e.length} linha(s) com IDs duplicados:
`);for(let n of e){let a=await er(o,t.name,n.ids),l=n.ids.map(async c=>{let p=await x(o,t.name,c);return{id:c,count:p}}),m=await Promise.all(l);s[n.numeroLinha-1]=or(n.linha,a),i.push(`Linha ${n.numeroLinha}:`),i.push(`  IDs encontrados: ${n.ids.map(c=>`^${c}`).join(", ")}`),m.forEach(c=>{i.push(`    ^${c.id}: ${c.count} refer\xEAncia(s)`)}),i.push(`  \u2713 Mantido: ^${a}`),i.push(`  \u2717 Removidos: ${n.ids.filter(c=>c!==a).map(c=>`^${c}`).join(", ")}`),i.push("")}return{conteudo:s.join(`
`),relatorio:i}}var I=class extends u.Plugin{async onload(){this.processador=new D,this.addCommand({id:"processar-legislacao",name:"Processar documento de legisla\xE7\xE3o",editorCallback:async(t,r)=>{if(!r.file){new u.Notice("Nenhum arquivo aberto");return}try{let s=t.getValue(),i=this.processador.processar(s);t.setValue(i),new u.Notice("Documento processado com sucesso!")}catch(s){console.error("Erro ao processar documento:",s),new u.Notice("Erro ao processar documento. Verifique o console.")}}}),this.addCommand({id:"limpar-ids-duplicados",name:"Limpar IDs duplicados (buscar refer\xEAncias)",editorCallback:async(t,r)=>{let e=r.file;if(!e){new u.Notice("Nenhum arquivo aberto");return}try{new u.Notice("Buscando IDs duplicados e refer\xEAncias no vault...");let s=t.getValue(),i=await X(this.app.vault,e,s);i.conteudo!==s?(t.setValue(i.conteudo),console.log("=== Relat\xF3rio de Limpeza de IDs Duplicados ==="),i.relatorio.forEach(n=>console.log(n)),new u.Notice("IDs duplicados removidos! Veja o console para detalhes.")):new u.Notice("Nenhum ID duplicado encontrado.")}catch(s){console.error("Erro ao limpar IDs duplicados:",s),new u.Notice("Erro ao limpar IDs duplicados. Verifique o console.")}}}),console.log("Plugin Legisla\xE7\xE3o Limpa carregado")}onunload(){console.log("Plugin Legisla\xE7\xE3o Limpa descarregado")}};
