var S=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var j=(s,t)=>{for(var r in t)S(s,r,{get:t[r],enumerable:!0})},y=(s,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of X(t))!_.call(s,o)&&o!==r&&S(s,o,{get:()=>t[o],enumerable:!(a=q(t,o))||a.enumerable});return s};var B=s=>y(S({},"__esModule",{value:!0}),s);var dt={};j(dt,{default:()=>R});module.exports=B(dt);var h=require("obsidian");var k={"lei complementar":"LC","lei ordin\xE1ria":"LO",lei:"L","decreto-lei":"DL",decreto:"D","medida provis\xF3ria":"MP","emenda constitucional":"EC",resolu\u00E7\u00E3o:"Res",portaria:"Port","instru\xE7\xE3o normativa":"IN"};function Z(s){let t=/\*\*\[?(LEI COMPLEMENTAR|LEI ORDINÁRIA|LEI|DECRETO-LEI|DECRETO|MEDIDA PROVISÓRIA|EMENDA CONSTITUCIONAL|RESOLUÇÃO|PORTARIA|INSTRUÇÃO NORMATIVA)\s*[Nn]?[ºª°]?\s*(\d+(?:\.\d+)?),?\s*DE\s*\d+\s*DE\s*\w+\s*DE\s*(\d{4})/i,r=s.match(t);if(!r)return null;let a=H(r[1]),o=r[1].toLowerCase(),n=k[o]||a.substring(0,2).toUpperCase(),i=r[2],e=r[3];return{tipoCompleto:a,tipoAbreviado:n,numero:i,ano:e}}function H(s){return s.toLowerCase().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function G(s){let{tipoCompleto:t,tipoAbreviado:r,numero:a,ano:o}=s;return[`${t} n\xBA ${a}/${o}`,`${r} n\xBA ${a}/${o}`,`${t} ${a}/${o}`,`${r} ${a}/${o}`]}function J(s){let t=[],r=s.match(/^aliases:\s*\n((?:\s+-\s*.+\n?)*)/m);if(r){let o=r[1].split(`
`);for(let n of o){let i=n.match(/^\s+-\s*["']?([^"'\n]+)["']?\s*$/);i&&t.push(i[1].trim())}return t}let a=s.match(/^aliases:\s*\[([^\]]*)\]/m);if(a){let o=a[1].split(",");for(let n of o){let i=n.trim().replace(/^["']|["']$/g,"");i&&t.push(i)}}return t}function W(s){let t=s.split(`
`),r=[],a=!1;for(let o of t){if(/^aliases:/.test(o)){a=!0,/^aliases:\s*\[/.test(o)&&(a=!1);continue}if(a){if(/^\s+-/.test(o)||/^\s+["']/.test(o))continue;a=!1}r.push(o)}return r.join(`
`)}function D(s){let t=/^---\n([\s\S]*?)\n---/,r=s.match(t);if(!r)return s;let a=r[1],o=Z(s);if(!o)return s;let n=G(o),i=J(a),e=new Set(i);for(let p of n)e.add(p);let l=`aliases:
${Array.from(e).map(p=>`  - "${p}"`).join(`
`)}`,c=W(a),u=c.trim()?`${c}
${l}`:l;return s.replace(t,`---
${u}
---`)}function b(s){let t=/\|\s*!\[.*?[Bb]ras.*?\]\(.*?\)\s*\|.*\|\n\|\s*---\s*\|\s*---\s*\|\n?/g;return s.replace(t,"")}function Q(s=6){let t="abcdefghijklmnopqrstuvwxyz0123456789",r="";for(let a=0;a<s;a++)r+=t.charAt(Math.floor(Math.random()*t.length));return r}function I(s,t=6){let r;do r=Q(t);while(s.has(r));return s.add(r),r}function L(s,t){let r={},a=s;return a=a.replace(/<table[\s\S]*?<\/table>/gi,o=>{let i=`<!--PROTECTED_TABLE_${I(t)}-->`;return r[i]=o,i}),a=a.replace(/(?:^\|.+\|$\n?)+/gm,o=>{if(o.includes("<!--PROTECTED_TABLE_")||o.trim().length<5)return o;let i=`<!--PROTECTED_TABLE_${I(t)}-->`;return r[i]=o,i}),{conteudo:a,tabelas:r}}function M(s,t){let r=s;for(let[a,o]of Object.entries(t))r=r.replace(a,o);return r}var Y=[{pattern:/^(LIVRO\s+[IVXLCDM\d]+)$/i,nivel:1},{pattern:/^(ANEXO\s+[IVXLCDM\d]+)$/i,nivel:1},{pattern:/^(TÍTULO\s+[IVXLCDM\d]+)$/i,nivel:2},{pattern:/^(CAPÍTULO\s+[IVXLCDM\d]+)$/i,nivel:3},{pattern:/^(Seção\s+[IVXLCDM\d]+)$/i,nivel:4},{pattern:/^(Subseção\s+[IVXLCDM\d]+)$/i,nivel:5}],K=/^#{1,6}\s+(LIVRO|ANEXO|TÍTULO|CAPÍTULO|Seção|Subseção)\s+[IVXLCDM\d]+(\s*[-–—].*)?$/i;function E(s){let t=s.split(`
`),r=[],a=0;for(;a<t.length;){let o=t[a],n=o.trim();if(K.test(n)){r.push(o),a++;continue}if(o.trimStart().startsWith(">")){r.push(o),a++;continue}let i=!1;for(let e of Y){let g=n.match(e.pattern);if(g){let l=g[1],c="#".repeat(e.nivel),u="",p=a+1;for(;p<t.length&&t[p].trim()==="";)p++;if(p<t.length){let f=t[p].trim();f&&!tt(f)&&(u=f,a=p)}u?r.push(`${c} ${l} - ${u}`):r.push(`${c} ${l}`),i=!0;break}}i||r.push(t[a]),a++}return r.join(`
`)}function tt(s){return[/^(LIVRO|ANEXO|TÍTULO|CAPÍTULO)\s+[IVXLCDM\d]+$/i,/^(Seção|Subseção)\s+[IVXLCDM\d]+$/i,/^Art\.\s*\d+/i,/^§\s*\d+/i,/^Parágrafo único/i,/^[IVXLCDM]+\s*[-–—]/,/^[a-z]\)\s*/,/^<!--/].some(r=>r.test(s))}var rt=/\s\^[a-z0-9]{6}$/,A={artigo:/^\*\*Art\.\s*(\d+[º°]?(?:-[A-Z])?)\*\*/,paragrafo:/^§\s*(\d+[º°]?)/,paragrafoUnico:/^Parágrafo único/i,inciso:/^([IVXLCDM]+)\s*[-–—]/,alinea:/^([a-z])\)/};function C(s,t,r){let a=s.split(`
`),o=[],n=null,i=null,e=null;for(let c of a){let u=c.trim();if(rt.test(u)){o.push(c),g(u);continue}let{tipo:p,chave:f,novaLinha:m}=l(c,u);if(p&&f){let d;r!=null&&r.has(f)?(d=r.get(f),t.add(d)):d=I(t),o.push(`${m} ^${d}`)}else o.push(c)}return o.join(`
`);function g(c){let u=c.match(A.artigo);if(u){n=`Art. ${u[1]}`,i=null,e=null;return}if(A.paragrafoUnico.test(c)){i="Par\xE1grafo \xFAnico",e=null;return}let p=c.match(A.paragrafo);if(p){i=`\xA7 ${p[1]}`,e=null;return}let f=c.match(A.inciso);if(f){e=f[1];return}}function l(c,u){let p=u.match(A.artigo);if(p)return n=`Art. ${p[1]}`,i=null,e=null,{tipo:"artigo",chave:n,novaLinha:c};if(A.paragrafoUnico.test(u))return i="Par\xE1grafo \xFAnico",e=null,{tipo:"paragrafoUnico",chave:n?`Par\xE1grafo \xFAnico do ${n}`:null,novaLinha:c};let f=u.match(A.paragrafo);if(f){let v=`\xA7 ${f[1]}`;return i=v,e=null,{tipo:"paragrafo",chave:n?`${v} do ${n}`:null,novaLinha:c}}let m=u.match(A.inciso);if(m){let v=m[1];e=v;let $=n;return i&&n&&($=`${i} do ${n}`),{tipo:"inciso",chave:$?`${v} do ${$}`:null,novaLinha:c}}let d=u.match(A.alinea);if(d){let v=d[1],$=n;return e?i&&n?$=`${e} do ${i} do ${n}`:n&&($=`${e} do ${n}`):i&&n&&($=`${i} do ${n}`),{tipo:"alinea",chave:$?`${v}) do ${$}`:null,novaLinha:c}}return{tipo:null,chave:null,novaLinha:c}}}var ot=/^(\s*)(\*\*)?(Art\.\s*\d+[º°]?(?:-[A-Z])?)(\*\*)?\s*(.*)$/gm;function x(s){return s.replace(ot,(t,r,a,o,n,i)=>{let e=o.trim(),g=i.trim();return g?`**${e}** ${g}`:`**${e}**`})}function at(s){let t=s.replace(/Art\*\*\.\*\*\s*/g,"Art. ");return t=t.replace(/^(Art\.\s*\d+)\*\*\.\*\*([A-ZÀ-Ú])/gm,"$1. $2"),t}function st(s){return s.replace(/^(Art\.\s*\d+[º°](?:-[A-Z])?)([A-ZÀ-Ú])/gm,"$1 $2")}function nt(s){return s.replace(/^(§\s*\d+[º°])([A-ZÀ-Ú])/gm,"$1 $2")}function it(s){return s.replace(/  +/g," ")}function P(s){let t=s;return t=at(t),t=st(t),t=nt(t),t=it(t),t}var et={artigo:/^(?:\*\*)?Art\.\s*(\d+[º°]?(?:-[A-Z])?)/i,paragrafo:/^§\s*(\d+[º°]?)/i,paragrafoUnico:/^Parágrafo único/i,inciso:/^([IVXLCDM]+)\s*[-–—]/,alinea:/^([a-z])\)/,item:/^(\d+)\\\./};function w(s){let t=s.trim();for(let[r,a]of Object.entries(et)){let o=t.match(a);if(o)return r==="paragrafoUnico"?"Par\xE1grafo \xFAnico":`${r}:${o[1]}`}return null}function ct(s){return/\[\(Redação dada pela/.test(s)}function O(s){let t=s.split(`
`),r=[],a=0;for(;a<t.length;){let o=t[a],n=w(o);if(!n){r.push(o),a++;continue}let i=a+1;for(;i<t.length&&t[i].trim()==="";)i++;if(i<t.length){let e=t[i];if(w(e)===n&&ct(e)){r.push("> [!note]- Reda\xE7\xE3o original"),r.push(`> ${o.trim()}`),r.push(""),a=i;continue}}r.push(o),a++}return r.join(`
`)}var z=class{constructor(){this.tabelasProtegidas={};this.idsUtilizados=new Set}processar(t){let r=t;return r=this.normalizarTextoClipadoDoc(r),r=this.processarDuplicatasDoc(r),r=this.removerBrasaoDoc(r),r=this.protegerTabelasDoc(r),r=this.processarFrontmatterDoc(r),r=this.converterHierarquiaDoc(r),r=this.normalizarArtigosDoc(r),r=this.adicionarIdsDoc(r),r=this.restaurarTabelasDoc(r),r}protegerTabelasDoc(t){let r=L(t,this.idsUtilizados);return this.tabelasProtegidas=r.tabelas,r.conteudo}restaurarTabelasDoc(t){return M(t,this.tabelasProtegidas)}processarFrontmatterDoc(t){return D(t)}removerBrasaoDoc(t){return b(t)}converterHierarquiaDoc(t){return E(t)}normalizarArtigosDoc(t){return x(t)}adicionarIdsDoc(t){return C(t,this.idsUtilizados)}normalizarTextoClipadoDoc(t){return P(t)}processarDuplicatasDoc(t){return O(t)}};var lt=/\^([a-z0-9]{6})/g,T={artigo:/^\*\*Art\.\s*(\d+[º°]?(?:-[A-Z])?)\*\*/,paragrafo:/^§\s*(\d+[º°]?)/,paragrafoUnico:/^Parágrafo único/i,inciso:/^([IVXLCDM]+)\s*[-–—]/,alinea:/^([a-z])\)/};function V(s){let t=new Map,r=s.split(`
`),a=null,o=null,n=null;for(let i of r){let e=i.trim();if(!e)continue;let g=[...e.matchAll(lt)],l=g.length>0?g[0][1]:null,c=e.match(T.artigo);if(c){a=`Art. ${c[1]}`,o=null,n=null,l&&t.set(a,l);continue}if(T.paragrafoUnico.test(e)){if(o="Par\xE1grafo \xFAnico",n=null,l&&a){let m=`Par\xE1grafo \xFAnico do ${a}`;t.set(m,l)}continue}let u=e.match(T.paragrafo);if(u){let m=`\xA7 ${u[1]}`;if(o=m,n=null,l&&a){let d=`${m} do ${a}`;t.set(d,l)}continue}let p=e.match(T.inciso);if(p){let m=p[1];if(n=m,l){let d=a;if(o&&a&&(d=`${o} do ${a}`),d){let v=`${m} do ${d}`;t.set(v,l)}}continue}let f=e.match(T.alinea);if(f){let m=f[1];if(l){let d=a;if(n?o&&a?d=`${n} do ${o} do ${a}`:a&&(d=`${n} do ${a}`):o&&a&&(d=`${o} do ${a}`),d){let v=`${m}) do ${d}`;t.set(v,l)}}continue}}return t}function U(s,t){let r=V(s),a=r.size,o=t,n={},i=new Set;o=P(o);let e=o;o=O(o);let g=(e.match(/\(Redação dada pela/g)||[]).length;o=b(o);let l=L(o,i);o=l.conteudo,Object.assign(n,l.tabelas),o=ut(s,o),o=E(o),o=x(o),o=C(o,i,r),o=M(o,n);let c=gt(o,r),u=i.size-c;return{conteudo:o,idsReutilizados:c,idsNovos:u,duplicatasProcessadas:g}}function ut(s,t){let r=/^---\n([\s\S]*?)\n---/,a=s.match(r),o=t.match(r);if(!a||!o)return D(t);let n=pt(a[1]),i=D(t);if(n.length>0){let e=i.match(r);if(e){let g=e[1];g=g.replace(/(aliases:\n(?:\s+-\s*"[^"]+"\n)*)/,l=>{let c=n.filter(p=>!l.includes(p)).map(p=>`  - "${p}"`).join(`
`),u=l.endsWith(`
`)?l:l+`
`;return c?`${u}${c}
`:l}),i=i.replace(r,`---
${g}
---`)}}return i}function pt(s){let t=[],r=s.split(`
`),a=!1,o=[/^(Lei Complementar|LC|Lei|L|Decreto|D|Medida Provisória|MP|Emenda Constitucional|EC)\s*(nº\s*)?\d+/i];for(let n of r){if(/^aliases:/.test(n)){a=!0;continue}if(a)if(/^\s+-/.test(n)){let i=n.match(/^\s+-\s*["']?([^"'\n]+)["']?/);if(i){let e=i[1].trim();o.some(l=>l.test(e))||t.push(e)}}else/^\s/.test(n)||(a=!1)}return t}function gt(s,t){let r=0;for(let a of t.values())s.includes(`^${a}`)&&r++;return r}var N=class extends h.FuzzySuggestModal{constructor(t,r,a){super(t),this.arquivos=r,this.onEscolha=a,this.setPlaceholder("Selecione o arquivo de legisla\xE7\xE3o existente para atualizar")}getItems(){return this.arquivos}getItemText(t){return t.basename}onChooseItem(t){this.onEscolha(t)}},R=class extends h.Plugin{async onload(){this.processador=new z,this.addCommand({id:"processar-legislacao",name:"Processar documento de legisla\xE7\xE3o",editorCallback:async(t,r)=>{if(!r.file){new h.Notice("Nenhum arquivo aberto");return}try{let o=t.getValue(),n=this.processador.processar(o);t.setValue(n),new h.Notice("Documento processado com sucesso!")}catch(o){console.error("Erro ao processar documento:",o),new h.Notice("Erro ao processar documento. Verifique o console.")}}}),this.addCommand({id:"atualizar-legislacao",name:"Atualizar legisla\xE7\xE3o com nova vers\xE3o",editorCallback:async(t,r)=>{let a=r.file;if(!a){new h.Notice("Nenhum arquivo aberto");return}let o=this.app.vault.getMarkdownFiles().filter(n=>n.path!==a.path).sort((n,i)=>n.basename.localeCompare(i.basename));if(o.length===0){new h.Notice("Nenhum outro arquivo encontrado no vault");return}new N(this.app,o,async n=>{try{let i=t.getValue(),e=await this.app.vault.read(n),g=U(e,i);await this.app.vault.modify(n,g.conteudo),new h.Notice(`Legisla\xE7\xE3o atualizada!
IDs reutilizados: ${g.idsReutilizados}
IDs novos: ${g.idsNovos}
Duplicatas: ${g.duplicatasProcessadas}`),new h.Notice(`Arquivo atualizado: ${n.basename}`,5e3)}catch(i){console.error("Erro ao atualizar legisla\xE7\xE3o:",i),new h.Notice("Erro ao atualizar. Verifique o console.")}}).open()}}),console.log("Plugin Legisla\xE7\xE3o Limpa carregado")}onunload(){console.log("Plugin Legisla\xE7\xE3o Limpa descarregado")}};
