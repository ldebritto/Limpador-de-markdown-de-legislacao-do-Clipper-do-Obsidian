var A=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var Z=(o,t)=>{for(var r in t)A(o,r,{get:t[r],enumerable:!0})},z=(o,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of X(t))!w.call(o,e)&&e!==r&&A(o,e,{get:()=>t[e],enumerable:!(s=x(t,e))||s.enumerable});return o};var U=o=>z(A({},"__esModule",{value:!0}),o);var rr={};Z(rr,{default:()=>f});module.exports=U(rr);var u=require("obsidian");var j={"lei complementar":"LC","lei ordin\xE1ria":"LO",lei:"L","decreto-lei":"DL",decreto:"D","medida provis\xF3ria":"MP","emenda constitucional":"EC",resolu\u00E7\u00E3o:"Res",portaria:"Port","instru\xE7\xE3o normativa":"IN"};function q(o){let t=/\*\*\[?(LEI COMPLEMENTAR|LEI ORDINÁRIA|LEI|DECRETO-LEI|DECRETO|MEDIDA PROVISÓRIA|EMENDA CONSTITUCIONAL|RESOLUÇÃO|PORTARIA|INSTRUÇÃO NORMATIVA)\s*[Nn]?[ºª°]?\s*(\d+(?:\.\d+)?),?\s*DE\s*\d+\s*DE\s*\w+\s*DE\s*(\d{4})/i,r=o.match(t);if(!r)return null;let s=_(r[1]),e=r[1].toLowerCase(),n=j[e]||s.substring(0,2).toUpperCase(),i=r[2],c=r[3];return{tipoCompleto:s,tipoAbreviado:n,numero:i,ano:c}}function _(o){return o.toLowerCase().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function y(o){let{tipoCompleto:t,tipoAbreviado:r,numero:s,ano:e}=o;return[`${t} n\xBA ${s}/${e}`,`${r} n\xBA ${s}/${e}`,`${t} ${s}/${e}`,`${r} ${s}/${e}`]}function I(o){let t=/^---\n([\s\S]*?)\n---/,r=o.match(t);if(!r)return o;let s=r[1],e=q(o);if(!e)return o;let i=`aliases:
${y(e).map(c=>`  - "${c}"`).join(`
`)}`;if(/^aliases:/m.test(s)){let c=s.replace(/^aliases:[\s\S]*?(?=\n\w|\n$)/m,i);return o.replace(t,`---
${c}
---`)}else{let c=`${s}
${i}`;return o.replace(t,`---
${c}
---`)}}function L(o){let t=/\|\s*!\[.*?[Bb]ras.*?\]\(.*?\)\s*\|.*\|\n\|\s*---\s*\|\s*---\s*\|\n?/g;return o.replace(t,"")}function F(o=6){let t="abcdefghijklmnopqrstuvwxyz0123456789",r="";for(let s=0;s<o;s++)r+=t.charAt(Math.floor(Math.random()*t.length));return r}function $(o,t=6){let r;do r=F(t);while(o.has(r));return o.add(r),r}function T(o,t){let r={},s=o;return s=s.replace(/<table[\s\S]*?<\/table>/gi,e=>{let i=`<!--PROTECTED_TABLE_${$(t)}-->`;return r[i]=e,i}),s=s.replace(/(?:^\|.+\|$\n?)+/gm,e=>{if(e.includes("<!--PROTECTED_TABLE_")||e.trim().length<5)return e;let i=`<!--PROTECTED_TABLE_${$(t)}-->`;return r[i]=e,i}),{conteudo:s,tabelas:r}}function b(o,t){let r=o;for(let[s,e]of Object.entries(t))r=r.replace(s,e);return r}var B=[{pattern:/^(LIVRO\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:1},{pattern:/^(ANEXO\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:1},{pattern:/^(TÍTULO\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:2},{pattern:/^(CAPÍTULO\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:3},{pattern:/^(Seção\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:4},{pattern:/^(Subseção\s+[IVXLCDM\d]+(?:-[A-Z])?)$/i,nivel:5}];function E(o){let t=o.split(`
`),r=[],s=0;for(;s<t.length;){let e=t[s],n=e.trim();if(e.trimStart().startsWith(">")){r.push(e),s++;continue}let i=!1;for(let c of B){let a=n.match(c.pattern);if(a){let l=a[1],m="#".repeat(c.nivel),h="",p=s+1;for(;p<t.length;){let v=t[p].trim();if(v===""||k(v)){p++;continue}h=v,s=p;break}h?r.push(`${m} ${l} - ${h}`):r.push(`${m} ${l}`),i=!0;break}}i||r.push(t[s]),s++}return r.join(`
`)}function k(o){return[/^(LIVRO|ANEXO|TÍTULO|CAPÍTULO)\s+[IVXLCDM\d]+(?:-[A-Z])?$/i,/^(Seção|Subseção)\s+[IVXLCDM\d]+(?:-[A-Z])?$/i,/^Art\.\s*\d+/i,/^§\s*\d+/i,/^Parágrafo único/i,/^[IVXLCDM]+\s*[-–—]/,/^[a-z]\)\s*/,/^<!--/,/^\[.+\]$/].some(r=>r.test(o))}var W=[/^Art\.\s/i,/^§\s*\d+/i,/^Parágrafo único/i,/^[IVXLCDM]+\s*[-–—]/,/^[a-z]\)\s/];function O(o){let t=o.trimStart();return W.some(r=>r.test(t))}function C(o){var s;let t=o.split(`
`),r=[];for(let e of t){if(e.trim()===""){r.push(e);continue}if(e.trimStart().startsWith(">")){r.push(e);continue}if(e.trimStart().startsWith("~~")){r.push(e);continue}if((((s=e.match(/^(\s*)/))==null?void 0:s[1])||"").length>=4&&!O(e)){r.push(e);continue}O(e)?r.push(e.trimStart()):r.push(e)}return r.join(`
`)}var g=[/^\*\*(LIVRO\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i,/^\*\*(ANEXO\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i,/^\*\*(TÍTULO\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i,/^\*\*(CAPÍTULO\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i,/^\*\*(Seção\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i,/^\*\*(Subseção\s+[IVXLCDM\d]+(?:-[A-Z])?)\*\*$/i];function G(o){let t=o.trim();return g.some(r=>r.test(t))}function H(o){let t=o.trim(),r=t.replace(/^\*\*(.+)\*\*$/,"$1");return!r||[/^Art\.\s/i,/^§\s*\d+/i,/^Parágrafo único/i,/^[IVXLCDM]+\s*[-–—]/,/^[a-z]\)\s/,/^(LIVRO|ANEXO|TÍTULO|CAPÍTULO|Seção|Subseção)\s+[IVXLCDM\d]+(?:-[A-Z])?$/i].some(e=>e.test(r))?!1:/^\*\*[A-ZÀÁÂÃÇÉÊÍÓÔÕÚ]/.test(t)}function S(o){return o.replace(/^\*\*(.+)\*\*$/,"$1")}function R(o){let t=o.split(`
`),r=[];for(let s=0;s<t.length;s++){let e=t[s],n=e.trim();if(G(e)){r.push(S(n));continue}if(H(e)){let i=!1;if(s>0){let c=t[s-1].trim();if((g.some(a=>a.test(`**${c}**`))||g.some(a=>a.test(c)))&&(i=!0),s>1&&c===""){let a=t[s-2].trim();(g.some(l=>l.test(`**${a}**`))||g.some(l=>l.test(a)))&&(i=!0)}}if(i){r.push(S(n));continue}}r.push(e)}return r.join(`
`)}function N(o){let t=o;return t=t.replace(/^(\s*Art)\*\*\.\*\*/gm,"$1."),t=t.replace(/^(\s*Art\.\s*\d+[º°]?(?:-[A-Z])?)\*\*\.\*\*/gm,"$1."),t=t.replace(/^(\s*Art\.\s*\d+[º°]?(?:-[A-Z])?\.)(\S)/gm,"$1 $2"),t=t.replace(/^(\s*Art\.\s*\d+[º°](?:-[A-Z])?)(?![-\.])(\S)/gm,"$1 $2"),t}function P(o){return o.trimStart().startsWith("~~")}function Q(o,t){for(let r=t;r<o.length;r++)if(o[r].trim()!=="")return o[r];return null}function V(o){let t=o.split(`
`),r=[],s=!1;for(let e=0;e<t.length;e++){let n=t[e],i=P(n),c=n.trim()==="";if(i)s||(r.push("> [!Quote]- Reda\xE7\xE3o revogada"),s=!0),r.push(`> ${n.trimStart()}`);else if(c&&s){let a=Q(t,e+1);a&&P(a)?r.push(">"):(s=!1,r.push(""))}else s=!1,r.push(n)}return r.join(`
`)}var d=class{constructor(){this.tabelasProtegidas={};this.idsUtilizados=new Set}processar(t){let r=t;return r=this.removerBrasaoDoc(r),r=this.protegerTabelasDoc(r),r=this.processarFrontmatterDoc(r),r=this.converterNegritoDoc(r),r=this.normalizarArtigosDoc(r),r=this.removerIndentacaoDoc(r),r=this.converterHierarquiaDoc(r),r=this.restaurarTabelasDoc(r),r=this.agruparRevogadasDoc(r),r}protegerTabelasDoc(t){let r=T(t,this.idsUtilizados);return this.tabelasProtegidas=r.tabelas,r.conteudo}restaurarTabelasDoc(t){return b(t,this.tabelasProtegidas)}processarFrontmatterDoc(t){return I(t)}removerBrasaoDoc(t){return L(t)}converterNegritoDoc(t){return R(t)}normalizarArtigosDoc(t){return N(t)}removerIndentacaoDoc(t){return C(t)}converterHierarquiaDoc(t){return E(t)}agruparRevogadasDoc(t){return V(t)}};var D=/\^([a-z0-9]{6})/g;function Y(o){let t=new Set,r=o.split(`
`);for(let s of r)if(!s.trimStart().startsWith("~~"))for(let e of s.matchAll(D))t.add(e[1]);return Array.from(t)}async function J(o,t,r){let s=new Set;if(r.length===0)return s;let e=o.getMarkdownFiles(),n=r.map(a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|"),i=new RegExp(`\\[\\[(?:[^\\]]+)?#\\^(${n})(?:\\|[^\\]]*)?\\]\\]`,"g"),c=t.replace(".md","");for(let a of e)if(a.basename!==c){try{let l=await o.cachedRead(a);for(let m of l.matchAll(i))s.add(m[1])}catch(l){console.error(`Erro ao ler arquivo ${a.path}:`,l)}if(s.size===r.length)break}return s}function K(o,t){let r=Array.from(o.matchAll(D));if(r.length===0)return o;let s=r.map(n=>n[1]).filter(n=>t.has(n)),e=o.replace(D,"").trim();for(let n of s)e=`${e} ^${n}`;return e}async function M(o,t,r){let s=Y(r);if(s.length===0)return{conteudo:r,relatorio:[]};let e=await J(o,t.name,s),n=s.filter(l=>!e.has(l));if(n.length===0)return{conteudo:r,relatorio:[]};let c=r.split(`
`).map(l=>l.trimStart().startsWith("~~")?l:K(l,e)),a=[];return a.push(`IDs no documento: ${s.length}`),a.push(`IDs com refer\xEAncias (preservados): ${e.size}`),e.size>0&&a.push(`  ${Array.from(e).map(l=>`^${l}`).join(", ")}`),a.push(`IDs sem refer\xEAncias (removidos): ${n.length}`),{conteudo:c.join(`
`),relatorio:a}}var f=class extends u.Plugin{async onload(){this.processador=new d,this.addCommand({id:"processar-legislacao",name:"Processar documento de legisla\xE7\xE3o",editorCallback:async(t,r)=>{let s=r.file;if(!s){new u.Notice("Nenhum arquivo aberto");return}try{let e=t.getValue(),n=this.processador.processar(e),i=await M(this.app.vault,s,n);n=i.conteudo,i.relatorio.length>0&&(console.log("=== Limpeza de IDs ==="),i.relatorio.forEach(c=>console.log(c))),t.setValue(n),new u.Notice("Documento processado com sucesso!")}catch(e){console.error("Erro ao processar documento:",e),new u.Notice("Erro ao processar documento. Verifique o console.")}}}),console.log("Plugin Legisla\xE7\xE3o Limpa carregado")}onunload(){console.log("Plugin Legisla\xE7\xE3o Limpa descarregado")}};
